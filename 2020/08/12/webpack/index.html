<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>webpack官方指南学习笔记 | Zimomo</title><meta name="description" content="webpack官方指南学习笔记"><meta name="keywords" content="webpack"><meta name="author" content="Zimomo"><meta name="copyright" content="Zimomo"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="webpack官方指南学习笔记"><meta name="twitter:description" content="webpack官方指南学习笔记"><meta name="twitter:image" content="zimomo333.com/img/webpack.jpg"><meta property="og:type" content="article"><meta property="og:title" content="webpack官方指南学习笔记"><meta property="og:url" content="zimomo333.com/2020/08/12/webpack/"><meta property="og:site_name" content="Zimomo"><meta property="og:description" content="webpack官方指南学习笔记"><meta property="og:image" content="zimomo333.com/img/webpack.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = 'false'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="zimomo333.com/2020/08/12/webpack/"><link rel="prev" title="js防抖节流" href="/zimomo333.com/2020/08/13/js-debounce-throttle/"><link rel="next" title="js排序算法" href="/zimomo333.com/2020/08/10/js-sort/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">7</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">6</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#起步"><span class="toc-number">1.</span> <span class="toc-text">起步</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本安装"><span class="toc-number">1.1.</span> <span class="toc-text">基本安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#目录结构"><span class="toc-number">1.2.</span> <span class="toc-text">目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#package-json"><span class="toc-number">1.3.</span> <span class="toc-text">package.json</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack-config-js配置文件"><span class="toc-number">1.4.</span> <span class="toc-text">webpack.config.js配置文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#管理资源文件"><span class="toc-number">2.</span> <span class="toc-text">管理资源文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#加载CSS"><span class="toc-number">2.1.</span> <span class="toc-text">加载CSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack-config-js"><span class="toc-number">2.1.1.</span> <span class="toc-text">webpack.config.js</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#加载图片、字体、CSV、XML文件"><span class="toc-number">2.2.</span> <span class="toc-text">加载图片、字体、CSV、XML文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack-config-js-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">webpack.config.js</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#管理输出"><span class="toc-number">3.</span> <span class="toc-text">管理输出</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#配置-entry-分离入口起点"><span class="toc-number">3.1.</span> <span class="toc-text">配置 entry 分离入口起点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack-config-js-2"><span class="toc-number">3.1.1.</span> <span class="toc-text">webpack.config.js</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#html-webpack-plugin"><span class="toc-number">3.2.</span> <span class="toc-text">html-webpack-plugin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#解决痛点："><span class="toc-number">3.2.1.</span> <span class="toc-text">解决痛点：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#如果更改了一个入口起点的名称，或添加了一个新的名称，生成的包将被重命名在一个构建中，但是index-html文件仍然会引用旧的名字，需要手动配置。"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">如果更改了一个入口起点的名称，或添加了一个新的名称，生成的包将被重命名在一个构建中，但是index.html文件仍然会引用旧的名字，需要手动配置。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用HtmlWebpackPlugin-生成-index-html，会自动添加所有-bundle。"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">使用HtmlWebpackPlugin 生成 index.html，会自动添加所有 bundle。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack-config-js-3"><span class="toc-number">3.2.2.</span> <span class="toc-text">webpack.config.js</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#clean-webpack-plugin-清理-dist-文件夹"><span class="toc-number">3.3.</span> <span class="toc-text">clean-webpack-plugin 清理 &#x2F;dist 文件夹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#每次构建前清理-dist-文件夹"><span class="toc-number">3.3.1.</span> <span class="toc-text">每次构建前清理 &#x2F;dist 文件夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack-config-js-4"><span class="toc-number">3.3.2.</span> <span class="toc-text">webpack.config.js</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#开发环境调试"><span class="toc-number">4.</span> <span class="toc-text">开发环境调试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#source-map"><span class="toc-number">4.1.</span> <span class="toc-text">source map</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#解决痛点：-1"><span class="toc-number">4.1.1.</span> <span class="toc-text">解决痛点：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#source-map-可将编译后的代码映射回原始源代码，准确反馈错误源文件。"><span class="toc-number">4.1.1.1.</span> <span class="toc-text">source map 可将编译后的代码映射回原始源代码，准确反馈错误源文件。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack-config-js-5"><span class="toc-number">4.1.2.</span> <span class="toc-text">webpack.config.js</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#热加载模式"><span class="toc-number">4.2.</span> <span class="toc-text">热加载模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack’s-Watch-Mode"><span class="toc-number">4.2.1.</span> <span class="toc-text">webpack’s Watch Mode</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（需要手动刷新浏览器）"><span class="toc-number">4.2.1.1.</span> <span class="toc-text">（需要手动刷新浏览器）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加一个用于启动-webpack-的观察模式的-npm-script-脚本："><span class="toc-number">4.2.1.2.</span> <span class="toc-text">添加一个用于启动 webpack 的观察模式的 npm script 脚本：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#package-json-1"><span class="toc-number">4.2.1.3.</span> <span class="toc-text">package.json</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改clean-webpack-plugin设置"><span class="toc-number">4.2.1.4.</span> <span class="toc-text">修改clean-webpack-plugin设置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Watch模式下，防止误删未变更的index-html"><span class="toc-number">4.2.1.4.1.</span> <span class="toc-text">Watch模式下，防止误删未变更的index.html</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#webpack-config-js-6"><span class="toc-number">4.2.1.4.2.</span> <span class="toc-text">webpack.config.js</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack-dev-server"><span class="toc-number">4.2.2.</span> <span class="toc-text">webpack-dev-server</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（实时重新加载页面-live-reloading）"><span class="toc-number">4.2.2.1.</span> <span class="toc-text">（实时重新加载页面 live reloading）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#以下配置告知-webpack-dev-server，在-localhost-8080-下建立服务，将-dist-目录下的文件，作为可访问文件"><span class="toc-number">4.2.2.2.</span> <span class="toc-text">以下配置告知 webpack-dev-server，在 localhost:8080 下建立服务，将 dist 目录下的文件，作为可访问文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#webpack-config-js-7"><span class="toc-number">4.2.2.3.</span> <span class="toc-text">webpack.config.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加-运行开发服务器-dev-server-script-脚本"><span class="toc-number">4.2.2.4.</span> <span class="toc-text">添加 运行开发服务器(dev server)  script 脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#package-json-2"><span class="toc-number">4.2.2.4.1.</span> <span class="toc-text">package.json</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack-dev-middleware"><span class="toc-number">4.2.3.</span> <span class="toc-text">webpack-dev-middleware</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#webpack-config-js-8"><span class="toc-number">4.2.3.1.</span> <span class="toc-text">webpack.config.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#server-js"><span class="toc-number">4.2.3.2.</span> <span class="toc-text">server.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加-npm-script-脚本"><span class="toc-number">4.2.3.3.</span> <span class="toc-text">添加 npm script 脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#package-json-3"><span class="toc-number">4.2.3.3.1.</span> <span class="toc-text">package.json</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#模块热替换（HMR）"><span class="toc-number">5.</span> <span class="toc-text">模块热替换（HMR）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#（更改模块不需要重新加载页面-live-reloading）"><span class="toc-number">5.1.</span> <span class="toc-text">（更改模块不需要重新加载页面 live reloading）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在-webpack-dev-server-的配置基础上，使用-webpack-内置的-HMR-插件"><span class="toc-number">5.1.1.</span> <span class="toc-text">在 webpack-dev-server 的配置基础上，使用 webpack 内置的 HMR 插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#webpack-config-js-9"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">webpack.config.js</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NamedModulesPlugin-作用是在热加载时直接返回更新文件名，而不是文件的id"><span class="toc-number">5.1.2.</span> <span class="toc-text">NamedModulesPlugin 作用是在热加载时直接返回更新文件名，而不是文件的id</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#index-js"><span class="toc-number">5.1.2.1.</span> <span class="toc-text">index.js</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#存在问题（需要重新绑定模块）"><span class="toc-number">5.1.3.</span> <span class="toc-text">存在问题（需要重新绑定模块）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HMR-修改样式表"><span class="toc-number">5.2.</span> <span class="toc-text">HMR 修改样式表</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tree-shaking"><span class="toc-number">6.</span> <span class="toc-text">tree shaking</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#用于移除-JavaScript-上下文中的未引用代码-dead-code"><span class="toc-number">6.0.1.</span> <span class="toc-text">用于移除 JavaScript 上下文中的未引用代码(dead-code)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#将文件标记为无副作用-side-effect-free"><span class="toc-number">6.1.</span> <span class="toc-text">将文件标记为无副作用(side-effect-free)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#所有代码都不包含副作用"><span class="toc-number">6.1.1.</span> <span class="toc-text">所有代码都不包含副作用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#package-json-4"><span class="toc-number">6.1.1.1.</span> <span class="toc-text">package.json</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#副作用黑名单（不进行tree-shaking操作）"><span class="toc-number">6.1.2.</span> <span class="toc-text">副作用黑名单（不进行tree shaking操作）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#压缩输出"><span class="toc-number">6.2.</span> <span class="toc-text">压缩输出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#生产模式"><span class="toc-number">6.2.1.</span> <span class="toc-text">生产模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#代码压缩（去除空格、缩短变量名）-tree-shaking（移除未引用代码）"><span class="toc-number">6.2.1.1.</span> <span class="toc-text">代码压缩（去除空格、缩短变量名）+ tree shaking（移除未引用代码）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#webpack-config-js-10"><span class="toc-number">6.2.1.1.1.</span> <span class="toc-text">webpack.config.js</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#开发模式"><span class="toc-number">6.2.2.</span> <span class="toc-text">开发模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#未压缩便于调试"><span class="toc-number">6.2.2.1.</span> <span class="toc-text">未压缩便于调试</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#通用、生产、开发环境配置分离"><span class="toc-number">7.</span> <span class="toc-text">通用、生产、开发环境配置分离</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#目录结构-1"><span class="toc-number">7.0.0.1.</span> <span class="toc-text">目录结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#webpack-common-js"><span class="toc-number">7.0.0.2.</span> <span class="toc-text">webpack.common.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#webpack-dev-js"><span class="toc-number">7.0.0.3.</span> <span class="toc-text">webpack.dev.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#webpack-prod-js"><span class="toc-number">7.0.0.4.</span> <span class="toc-text">webpack.prod.js</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NPM-Scripts"><span class="toc-number">7.0.1.</span> <span class="toc-text">NPM Scripts</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#package-json-5"><span class="toc-number">7.0.1.0.1.</span> <span class="toc-text">package.json</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NODE-ENV系统环境变量"><span class="toc-number">7.1.</span> <span class="toc-text">NODE_ENV系统环境变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#任何位于-src-的本地代码都可以关联到-process-env-NODE-ENV-环境变量"><span class="toc-number">7.1.0.1.</span> <span class="toc-text">任何位于 &#x2F;src 的本地代码都可以关联到 process.env.NODE_ENV 环境变量</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#src-index-js"><span class="toc-number">7.1.0.1.1.</span> <span class="toc-text">src&#x2F;index.js</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#代码分离"><span class="toc-number">8.</span> <span class="toc-text">代码分离</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#三种常用的代码分离方法："><span class="toc-number">8.0.0.1.</span> <span class="toc-text">三种常用的代码分离方法：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#入口起点-entry-points"><span class="toc-number">8.1.</span> <span class="toc-text">入口起点(entry points)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#project"><span class="toc-number">8.1.0.0.1.</span> <span class="toc-text">project</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#another-module-js"><span class="toc-number">8.1.0.0.2.</span> <span class="toc-text">another-module.js</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#webpack-config-js-11"><span class="toc-number">8.1.0.0.3.</span> <span class="toc-text">webpack.config.js</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#构建结果："><span class="toc-number">8.1.0.0.4.</span> <span class="toc-text">构建结果：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#index-js和another-module-js都含有lodash模块"><span class="toc-number">8.1.0.0.5.</span> <span class="toc-text">index.js和another-module.js都含有lodash模块</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#缺点："><span class="toc-number">8.1.0.1.</span> <span class="toc-text">缺点：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#防止重复-prevent-duplication"><span class="toc-number">8.2.</span> <span class="toc-text">防止重复(prevent duplication)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#webpack-config-js-12"><span class="toc-number">8.2.0.1.</span> <span class="toc-text">webpack.config.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#构建效果："><span class="toc-number">8.2.0.2.</span> <span class="toc-text">构建效果：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态导入-dynamic-imports"><span class="toc-number">8.3.</span> <span class="toc-text">动态导入(dynamic imports)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在index-js中动态导入-lodash模块"><span class="toc-number">8.3.1.</span> <span class="toc-text">在index.js中动态导入 lodash模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#webpack-config-js-13"><span class="toc-number">8.3.1.0.1.</span> <span class="toc-text">webpack.config.js</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#src-index-js-1"><span class="toc-number">8.3.1.1.</span> <span class="toc-text">src&#x2F;index.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lodash-自动会分离到一个单独的-bundle："><span class="toc-number">8.3.1.2.</span> <span class="toc-text">lodash 自动会分离到一个单独的 bundle：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#async-函数简化代码："><span class="toc-number">8.3.2.</span> <span class="toc-text">async 函数简化代码：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#src-index-js-2"><span class="toc-number">8.3.2.1.</span> <span class="toc-text">src&#x2F;index.js</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#懒加载"><span class="toc-number">9.</span> <span class="toc-text">懒加载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#src-print-js"><span class="toc-number">9.0.0.1.</span> <span class="toc-text">src&#x2F;print.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#src-index-js-3"><span class="toc-number">9.0.0.2.</span> <span class="toc-text">src&#x2F;index.js</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#缓存"><span class="toc-number">10.</span> <span class="toc-text">缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#chunkhash替换输出文件名"><span class="toc-number">10.1.</span> <span class="toc-text">chunkhash替换输出文件名</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#webpack-config-js-14"><span class="toc-number">10.1.0.1.</span> <span class="toc-text">webpack.config.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#构建结果：-1"><span class="toc-number">10.1.0.2.</span> <span class="toc-text">构建结果：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#这是因为-webpack-在入口-chunk-中，包含了某些样板-boilerplate-，特别是-runtime和-manifest。（样板-boilerplate-指-webpack-运行时的引导代码）"><span class="toc-number">10.1.0.2.1.</span> <span class="toc-text">这是因为 webpack 在入口 chunk 中，包含了某些样板(boilerplate)，特别是 runtime和 manifest。（样板(boilerplate)指 webpack 运行时的引导代码）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#提取模板-Extracting-Boilerplate"><span class="toc-number">10.2.</span> <span class="toc-text">提取模板(Extracting Boilerplate)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CommonsChunkPlugin-可将webpack-的样板和-manifest-提取出来"><span class="toc-number">10.2.0.1.</span> <span class="toc-text">CommonsChunkPlugin 可将webpack 的样板和 manifest 提取出来</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#webpack-config-js-15"><span class="toc-number">10.2.0.1.1.</span> <span class="toc-text">webpack.config.js</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#提取第三方库"><span class="toc-number">10.2.1.</span> <span class="toc-text">提取第三方库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#webpack-config-js-16"><span class="toc-number">10.2.1.1.</span> <span class="toc-text">webpack.config.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#构建结果：-2"><span class="toc-number">10.2.1.2.</span> <span class="toc-text">构建结果：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模块标识符-Module-Identifiers"><span class="toc-number">10.3.</span> <span class="toc-text">模块标识符(Module Identifiers)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HashedModuleIdsPlugin，推荐用于生产环境构建："><span class="toc-number">10.3.0.1.</span> <span class="toc-text">HashedModuleIdsPlugin，推荐用于生产环境构建：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#webpack-config-js-17"><span class="toc-number">10.3.0.2.</span> <span class="toc-text">webpack.config.js</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/webpack.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Zimomo</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">webpack官方指南学习笔记</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-08-12 01:55:08"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-08-12</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-08-17 02:37:48"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-08-17</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/webpack/">webpack</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2020/08/12/webpack/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2020/08/12/webpack/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="起步"><a href="#起步" class="headerlink" title="起步"></a>起步</h1><h2 id="基本安装"><a href="#基本安装" class="headerlink" title="基本安装"></a>基本安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir webpack-demo &amp;&amp; <span class="built_in">cd</span> webpack-demo</span><br><span class="line">npm init -y</span><br><span class="line">npm install webpack webpack-cli --save-dev</span><br></pre></td></tr></table></figure>



<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">webpack-demo</span><br><span class="line">|- package.json</span><br><span class="line">|- /dist</span><br><span class="line">  |- index.html</span><br><span class="line">|- /src</span><br><span class="line">  |- index.js</span><br></pre></td></tr></table></figure>



<h2 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h2><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  &#123;</span><br><span class="line">    "name": "webpack-demo",</span><br><span class="line"><span class="addition">+   "private": true,	//防止意外发布重要私密库</span></span><br><span class="line"><span class="deletion">-   "main": "index.js",	//入口起点名</span></span><br><span class="line">    "scripts": &#123;</span><br><span class="line">      "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",</span><br><span class="line"><span class="addition">+     "build": "webpack"	//npm run build 相当于 npx webpack --config webpack.config.js</span></span><br><span class="line">    &#125;,</span><br><span class="line">    "devDependencies": &#123;</span><br><span class="line">      "webpack": "^4.0.1",</span><br><span class="line">      "webpack-cli": "^2.0.9"</span><br><span class="line">    &#125;,</span><br><span class="line">    "dependencies": &#123;&#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h2 id="webpack-config-js配置文件"><a href="#webpack-config-js配置文件" class="headerlink" title="webpack.config.js配置文件"></a>webpack.config.js配置文件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>







<h1 id="管理资源文件"><a href="#管理资源文件" class="headerlink" title="管理资源文件"></a>管理资源文件</h1><h2 id="加载CSS"><a href="#加载CSS" class="headerlink" title="加载CSS"></a>加载CSS</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev style-loader css-loader</span><br></pre></td></tr></table></figure>

<h3 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h3><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  const path = require('path');</span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    entry: './src/index.js',</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: 'bundle.js',</span><br><span class="line">      path: path.resolve(__dirname, 'dist')</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="addition">+   module: &#123;</span></span><br><span class="line"><span class="addition">+     rules: [</span></span><br><span class="line"><span class="addition">+       &#123;</span></span><br><span class="line"><span class="addition">+         test: /\.css$/,</span></span><br><span class="line"><span class="addition">+         use: [</span></span><br><span class="line"><span class="addition">+           'style-loader',</span></span><br><span class="line"><span class="addition">+           'css-loader'</span></span><br><span class="line"><span class="addition">+         ]</span></span><br><span class="line"><span class="addition">+       &#125;</span></span><br><span class="line"><span class="addition">+     ]</span></span><br><span class="line"><span class="addition">+   &#125;</span></span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>



<h2 id="加载图片、字体、CSV、XML文件"><a href="#加载图片、字体、CSV、XML文件" class="headerlink" title="加载图片、字体、CSV、XML文件"></a>加载图片、字体、CSV、XML文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev file-loader</span><br></pre></td></tr></table></figure>

<h3 id="webpack-config-js-1"><a href="#webpack-config-js-1" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h3><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">  const path = require('path');</span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    entry: './src/index.js',</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: 'bundle.js',</span><br><span class="line">      path: path.resolve(__dirname, 'dist')</span><br><span class="line">    &#125;,</span><br><span class="line">    module: &#123;</span><br><span class="line">      rules: [</span><br><span class="line"><span class="addition">+       &#123;</span></span><br><span class="line"><span class="addition">+         test: /\.(png|svg|jpg|gif)$/,			//图片</span></span><br><span class="line"><span class="addition">+         use: [</span></span><br><span class="line"><span class="addition">+           'file-loader'</span></span><br><span class="line"><span class="addition">+         ]</span></span><br><span class="line"><span class="addition">+       &#125;,</span></span><br><span class="line"><span class="addition">+       &#123;</span></span><br><span class="line"><span class="addition">+         test: /\.(woff|woff2|eot|ttf|otf)$/,	//字体</span></span><br><span class="line"><span class="addition">+         use: [</span></span><br><span class="line"><span class="addition">+           'file-loader'</span></span><br><span class="line"><span class="addition">+         ]</span></span><br><span class="line"><span class="addition">+       &#125;,</span></span><br><span class="line"><span class="addition">+       &#123;</span></span><br><span class="line"><span class="addition">+         test: /\.(csv|tsv)$/,					//csv</span></span><br><span class="line"><span class="addition">+         use: [</span></span><br><span class="line"><span class="addition">+           'csv-loader'</span></span><br><span class="line"><span class="addition">+         ]</span></span><br><span class="line"><span class="addition">+       &#125;,</span></span><br><span class="line"><span class="addition">+       &#123;</span></span><br><span class="line"><span class="addition">+         test: /\.xml$/,						//xml</span></span><br><span class="line"><span class="addition">+         use: [</span></span><br><span class="line"><span class="addition">+           'xml-loader'</span></span><br><span class="line"><span class="addition">+         ]</span></span><br><span class="line"><span class="addition">+       &#125;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>







<h1 id="管理输出"><a href="#管理输出" class="headerlink" title="管理输出"></a>管理输出</h1><h2 id="配置-entry-分离入口起点"><a href="#配置-entry-分离入口起点" class="headerlink" title="配置 entry 分离入口起点"></a>配置 <a href="https://www.webpackjs.com/configuration/entry-context" target="_blank" rel="noopener"><code>entry</code></a> 分离入口起点</h2><h3 id="webpack-config-js-2"><a href="#webpack-config-js-2" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h3><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  const path = require('path');</span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line"><span class="deletion">-   entry: './src/index.js',</span></span><br><span class="line"><span class="addition">+   entry: &#123;</span></span><br><span class="line"><span class="addition">+     app: './src/index.js',</span></span><br><span class="line"><span class="addition">+     print: './src/print.js'</span></span><br><span class="line"><span class="addition">+   &#125;,</span></span><br><span class="line">    output: &#123;</span><br><span class="line"><span class="deletion">-     filename: 'bundle.js',</span></span><br><span class="line"><span class="addition">+     filename: '[name].bundle.js',</span></span><br><span class="line">      path: path.resolve(__dirname, 'dist')</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>



<h2 id="html-webpack-plugin"><a href="#html-webpack-plugin" class="headerlink" title="html-webpack-plugin"></a>html-webpack-plugin</h2><h3 id="解决痛点："><a href="#解决痛点：" class="headerlink" title="解决痛点："></a>解决痛点：</h3><h4 id="如果更改了一个入口起点的名称，或添加了一个新的名称，生成的包将被重命名在一个构建中，但是index-html文件仍然会引用旧的名字，需要手动配置。"><a href="#如果更改了一个入口起点的名称，或添加了一个新的名称，生成的包将被重命名在一个构建中，但是index-html文件仍然会引用旧的名字，需要手动配置。" class="headerlink" title="如果更改了一个入口起点的名称，或添加了一个新的名称，生成的包将被重命名在一个构建中，但是index.html文件仍然会引用旧的名字，需要手动配置。"></a>如果更改了一个入口起点的名称，或添加了一个新的名称，生成的包将被重命名在一个构建中，但是<code>index.html</code>文件仍然会引用旧的名字，需要手动配置。</h4><h4 id="使用HtmlWebpackPlugin-生成-index-html，会自动添加所有-bundle。"><a href="#使用HtmlWebpackPlugin-生成-index-html，会自动添加所有-bundle。" class="headerlink" title="使用HtmlWebpackPlugin 生成 index.html，会自动添加所有 bundle。"></a>使用<code>HtmlWebpackPlugin</code> 生成 index.html，会自动添加所有 bundle。</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev html-webpack-plugin</span><br></pre></td></tr></table></figure>

<h3 id="webpack-config-js-3"><a href="#webpack-config-js-3" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h3><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  const path = require('path');</span><br><span class="line"><span class="addition">+ const HtmlWebpackPlugin = require('html-webpack-plugin');</span></span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">      app: './src/index.js',</span><br><span class="line">      print: './src/print.js'</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="addition">+   plugins: [</span></span><br><span class="line"><span class="addition">+     new HtmlWebpackPlugin(&#123;</span></span><br><span class="line"><span class="addition">+       title: 'Output Management'</span></span><br><span class="line"><span class="addition">+     &#125;)</span></span><br><span class="line"><span class="addition">+   ],</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: '[name].bundle.js',</span><br><span class="line">      path: path.resolve(__dirname, 'dist')</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>



<h2 id="clean-webpack-plugin-清理-dist-文件夹"><a href="#clean-webpack-plugin-清理-dist-文件夹" class="headerlink" title="clean-webpack-plugin 清理 /dist 文件夹"></a>clean-webpack-plugin 清理 <code>/dist</code> 文件夹</h2><h3 id="每次构建前清理-dist-文件夹"><a href="#每次构建前清理-dist-文件夹" class="headerlink" title="每次构建前清理 /dist 文件夹"></a>每次构建前清理 <code>/dist</code> 文件夹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install clean-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>

<h3 id="webpack-config-js-4"><a href="#webpack-config-js-4" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h3><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  const path = require('path');</span><br><span class="line">  const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class="line"><span class="addition">+ const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin');</span></span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">      app: './src/index.js',</span><br><span class="line">      print: './src/print.js'</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line"><span class="addition">+     new CleanWebpackPlugin(),</span></span><br><span class="line">      new HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: 'Output Management'</span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: '[name].bundle.js',</span><br><span class="line">      path: path.resolve(__dirname, 'dist')</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>







<h1 id="开发环境调试"><a href="#开发环境调试" class="headerlink" title="开发环境调试"></a>开发环境调试</h1><h2 id="source-map"><a href="#source-map" class="headerlink" title="source map"></a>source map</h2><h3 id="解决痛点：-1"><a href="#解决痛点：-1" class="headerlink" title="解决痛点："></a>解决痛点：</h3><p>​    当 webpack 打包源代码时，可能会很难追踪到错误和警告在源代码中的原始位置。例如，如果将三个源文件（<code>a.js</code>, <code>b.js</code> 和 <code>c.js</code>）打包到一个 bundle（<code>bundle.js</code>）中，而其中一个源文件包含一个错误，那么堆栈跟踪就会简单地指向到 <code>bundle.js</code>，而实际需要准确地知道错误来自于哪个源文件。</p>
<h4 id="source-map-可将编译后的代码映射回原始源代码，准确反馈错误源文件。"><a href="#source-map-可将编译后的代码映射回原始源代码，准确反馈错误源文件。" class="headerlink" title="source map 可将编译后的代码映射回原始源代码，准确反馈错误源文件。"></a><a href="http://blog.teamtreehouse.com/introduction-source-maps" target="_blank" rel="noopener">source map</a> 可将编译后的代码映射回原始源代码，准确反馈错误源文件。</h4><h3 id="webpack-config-js-5"><a href="#webpack-config-js-5" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h3><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  const path = require('path');</span><br><span class="line">  const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class="line">  const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin');</span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">      app: './src/index.js',</span><br><span class="line">      print: './src/print.js'</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="addition">+   devtool: 'inline-source-map',</span></span><br><span class="line">    plugins: [</span><br><span class="line">      new CleanWebpackPlugin(),</span><br><span class="line">      new HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: 'Development'</span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: '[name].bundle.js',</span><br><span class="line">      path: path.resolve(__dirname, 'dist')</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>



<h2 id="热加载模式"><a href="#热加载模式" class="headerlink" title="热加载模式"></a>热加载模式</h2><p>webpack 中有三个热加载模式，帮助你在代码发生变化后自动编译代码：</p>
<ol>
<li>webpack’s Watch Mode（需要手动刷新浏览器）</li>
<li>webpack-dev-server（实时重新加载页面 live reloading）</li>
<li>webpack-dev-middleware</li>
</ol>
<h3 id="webpack’s-Watch-Mode"><a href="#webpack’s-Watch-Mode" class="headerlink" title="webpack’s Watch Mode"></a>webpack’s Watch Mode</h3><h4 id="（需要手动刷新浏览器）"><a href="#（需要手动刷新浏览器）" class="headerlink" title="（需要手动刷新浏览器）"></a>（需要手动刷新浏览器）</h4><h4 id="添加一个用于启动-webpack-的观察模式的-npm-script-脚本："><a href="#添加一个用于启动-webpack-的观察模式的-npm-script-脚本：" class="headerlink" title="添加一个用于启动 webpack 的观察模式的 npm script 脚本："></a>添加一个用于启动 webpack 的观察模式的 npm script 脚本：</h4><h4 id="package-json-1"><a href="#package-json-1" class="headerlink" title="package.json"></a>package.json</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  &#123;</span><br><span class="line">    "name": "development",</span><br><span class="line">    "scripts": &#123;</span><br><span class="line">      "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",</span><br><span class="line"><span class="addition">+     "watch": "webpack --watch",</span></span><br><span class="line">      "build": "webpack"	//npm run build 相当于 npx webpack --config webpack.config.js</span><br><span class="line">    &#125;,</span><br><span class="line">    "devDependencies": &#123;</span><br><span class="line">      "clean-webpack-plugin": "^0.1.16",</span><br><span class="line">      "html-webpack-plugin": "^2.29.0",</span><br><span class="line">      "webpack": "^3.0.0",</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="修改clean-webpack-plugin设置"><a href="#修改clean-webpack-plugin设置" class="headerlink" title="修改clean-webpack-plugin设置"></a>修改clean-webpack-plugin设置</h4><h5 id="Watch模式下，防止误删未变更的index-html"><a href="#Watch模式下，防止误删未变更的index-html" class="headerlink" title="Watch模式下，防止误删未变更的index.html"></a>Watch模式下，防止误删未变更的index.html</h5><p><a href="https://blog.csdn.net/qq_40285497/article/details/106401423" target="_blank" rel="noopener">https://blog.csdn.net/qq_40285497/article/details/106401423</a></p>
<h5 id="webpack-config-js-6"><a href="#webpack-config-js-6" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  const path = require('path');</span><br><span class="line">  const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class="line">  const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin');</span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">      app: './src/index.js',</span><br><span class="line">      print: './src/print.js'</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line"><span class="addition">+     new CleanWebpackPlugin(&#123;cleanStaleWebpackAssets: false&#125;),</span></span><br><span class="line">      new HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: 'Output Management'</span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: '[name].bundle.js',</span><br><span class="line">      path: path.resolve(__dirname, 'dist')</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>



<h3 id="webpack-dev-server"><a href="#webpack-dev-server" class="headerlink" title="webpack-dev-server"></a>webpack-dev-server</h3><h4 id="（实时重新加载页面-live-reloading）"><a href="#（实时重新加载页面-live-reloading）" class="headerlink" title="（实时重新加载页面 live reloading）"></a>（实时重新加载页面 live reloading）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack-dev-server</span><br></pre></td></tr></table></figure>

<h4 id="以下配置告知-webpack-dev-server，在-localhost-8080-下建立服务，将-dist-目录下的文件，作为可访问文件"><a href="#以下配置告知-webpack-dev-server，在-localhost-8080-下建立服务，将-dist-目录下的文件，作为可访问文件" class="headerlink" title="以下配置告知 webpack-dev-server，在 localhost:8080 下建立服务，将 dist 目录下的文件，作为可访问文件"></a>以下配置告知 <code>webpack-dev-server</code>，在 <code>localhost:8080</code> 下建立服务，将 <code>dist</code> 目录下的文件，作为可访问文件</h4><h4 id="webpack-config-js-7"><a href="#webpack-config-js-7" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">  const path = require('path');</span><br><span class="line">  const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class="line">  const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin');</span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">      app: './src/index.js',</span><br><span class="line">      print: './src/print.js'</span><br><span class="line">    &#125;,</span><br><span class="line">    devtool: 'inline-source-map',</span><br><span class="line"><span class="addition">+   devServer: &#123;</span></span><br><span class="line"><span class="addition">+     contentBase: './dist'</span></span><br><span class="line"><span class="addition">+   &#125;,</span></span><br><span class="line">    plugins: [</span><br><span class="line">      new CleanWebpackPlugin(),</span><br><span class="line">      new HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: 'Development'</span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: '[name].bundle.js',</span><br><span class="line">      path: path.resolve(__dirname, 'dist')</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<h4 id="添加-运行开发服务器-dev-server-script-脚本"><a href="#添加-运行开发服务器-dev-server-script-脚本" class="headerlink" title="添加 运行开发服务器(dev server)  script 脚本"></a>添加 运行开发服务器(dev server)  script 脚本</h4><h5 id="package-json-2"><a href="#package-json-2" class="headerlink" title="package.json"></a>package.json</h5><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  &#123;</span><br><span class="line">    "name": "development",</span><br><span class="line">    "scripts": &#123;</span><br><span class="line">      "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",</span><br><span class="line">      "watch": "webpack --watch",</span><br><span class="line"><span class="addition">+     "start": "webpack-dev-server --open",</span></span><br><span class="line">      "build": "webpack"</span><br><span class="line">    &#125;,</span><br><span class="line">    "devDependencies": &#123;</span><br><span class="line">      "clean-webpack-plugin": "^0.1.16",</span><br><span class="line">      "html-webpack-plugin": "^2.29.0",</span><br><span class="line">      "webpack": "^3.0.0",</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h3 id="webpack-dev-middleware"><a href="#webpack-dev-middleware" class="headerlink" title="webpack-dev-middleware"></a>webpack-dev-middleware</h3><p>​        <code>webpack-dev-middleware</code> 是一个容器(wrapper)，可以把 webpack 处理后的文件传递给一个服务器(server)。 <code>webpack-dev-server</code> 在内部使用了它，同时，它也可以作为一个单独的包来使用，以便进行更多自定义设置来实现更多的需求。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev express webpack-dev-middleware</span><br></pre></td></tr></table></figure>

<h4 id="webpack-config-js-8"><a href="#webpack-config-js-8" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  const path = require('path');</span><br><span class="line">  const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class="line">  const CleanWebpackPlugin = require('clean-webpack-plugin');</span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">      app: './src/index.js',</span><br><span class="line">      print: './src/print.js'</span><br><span class="line">    &#125;,</span><br><span class="line">    devtool: 'inline-source-map',</span><br><span class="line">    plugins: [</span><br><span class="line">      new CleanWebpackPlugin(['dist']),</span><br><span class="line">      new HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: 'Output Management'</span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: '[name].bundle.js',</span><br><span class="line">      path: path.resolve(__dirname, 'dist'),</span><br><span class="line"><span class="addition">+     publicPath: '/'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p><code>publicPath</code> 也会在服务器脚本用到，以确保文件资源能够在 <code>http://localhost:3000</code> 下正确访问</p>
<h4 id="server-js"><a href="#server-js" class="headerlink" title="server.js"></a>server.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">const</span> webpackDevMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-dev-middleware'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'./webpack.config.js'</span>);</span><br><span class="line"><span class="keyword">const</span> compiler = webpack(config);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Tell express to use the webpack-dev-middleware and use the webpack.config.js</span></span><br><span class="line"><span class="comment">// configuration file as a base.</span></span><br><span class="line">app.use(webpackDevMiddleware(compiler, &#123;</span><br><span class="line">  publicPath: config.output.publicPath</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Serve the files on port 3000.</span></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Example app listening on port 3000!\n'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="添加-npm-script-脚本"><a href="#添加-npm-script-脚本" class="headerlink" title="添加 npm script 脚本"></a>添加 npm script 脚本</h4><h5 id="package-json-3"><a href="#package-json-3" class="headerlink" title="package.json"></a>package.json</h5><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  &#123;</span><br><span class="line">    "name": "development",</span><br><span class="line">    "scripts": &#123;</span><br><span class="line">      "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",</span><br><span class="line">      "watch": "webpack --watch",</span><br><span class="line">      "start": "webpack-dev-server --open",</span><br><span class="line"><span class="addition">+     "server": "node server.js",</span></span><br><span class="line">      "build": "webpack"</span><br><span class="line">    &#125;,</span><br><span class="line">    "devDependencies": &#123;</span><br><span class="line">      "clean-webpack-plugin": "^0.1.16",</span><br><span class="line">      "html-webpack-plugin": "^2.29.0",</span><br><span class="line">      "webpack": "^3.0.0",</span><br><span class="line">      "webpack-dev-middleware": "^1.12.0",</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>







<h1 id="模块热替换（HMR）"><a href="#模块热替换（HMR）" class="headerlink" title="模块热替换（HMR）"></a>模块热替换（HMR）</h1><h2 id="（更改模块不需要重新加载页面-live-reloading）"><a href="#（更改模块不需要重新加载页面-live-reloading）" class="headerlink" title="（更改模块不需要重新加载页面 live reloading）"></a>（更改模块不需要重新加载页面 live reloading）</h2><h3 id="在-webpack-dev-server-的配置基础上，使用-webpack-内置的-HMR-插件"><a href="#在-webpack-dev-server-的配置基础上，使用-webpack-内置的-HMR-插件" class="headerlink" title="在 webpack-dev-server 的配置基础上，使用 webpack 内置的 HMR 插件"></a>在 <a href="https://github.com/webpack/webpack-dev-server" target="_blank" rel="noopener">webpack-dev-server</a> 的配置基础上，使用 webpack 内置的 HMR 插件</h3><h4 id="webpack-config-js-9"><a href="#webpack-config-js-9" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  const path = require('path');</span><br><span class="line">  const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class="line">  const CleanWebpackPlugin = require('clean-webpack-plugin');</span><br><span class="line"><span class="addition">+ const webpack = require('webpack');</span></span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line"><span class="deletion">-      app: './src/index.js',</span></span><br><span class="line"><span class="deletion">-      print: './src/print.js'</span></span><br><span class="line"><span class="addition">+      app: './src/index.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    devtool: 'inline-source-map',</span><br><span class="line">    devServer: &#123;</span><br><span class="line">      contentBase: './dist',</span><br><span class="line"><span class="addition">+     hot: true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      new CleanWebpackPlugin(['dist']),</span><br><span class="line">      new HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: 'Hot Module Replacement'</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="addition">+     new webpack.NamedModulesPlugin(),</span></span><br><span class="line"><span class="addition">+     new webpack.HotModuleReplacementPlugin()</span></span><br><span class="line">    ],</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: '[name].bundle.js',</span><br><span class="line">      path: path.resolve(__dirname, 'dist')</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="NamedModulesPlugin-作用是在热加载时直接返回更新文件名，而不是文件的id"><a href="#NamedModulesPlugin-作用是在热加载时直接返回更新文件名，而不是文件的id" class="headerlink" title="NamedModulesPlugin 作用是在热加载时直接返回更新文件名，而不是文件的id"></a><code>NamedModulesPlugin</code> 作用是在热加载时直接返回更新文件名，而不是文件的id</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[HMR] Updated modules:</span><br><span class="line">[HMR]  - ./example.js</span><br><span class="line">[HMR]  - ./hmr.js</span><br><span class="line">[HMR] Update applied.</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[HMR] Updated modules:</span><br><span class="line">[HMR]  - 39</span><br><span class="line">[HMR]  - 40</span><br><span class="line">[HMR] Update applied.</span><br></pre></td></tr></table></figure>

<h4 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  import printMe from './print.js';</span><br><span class="line"></span><br><span class="line">  function component() &#123;</span><br><span class="line">    var btn = document.createElement('button');</span><br><span class="line"></span><br><span class="line">    btn.innerHTML = 'Click me and check the console!';</span><br><span class="line">    btn.onclick = printMe;</span><br><span class="line"></span><br><span class="line">    element.appendChild(btn);</span><br><span class="line"></span><br><span class="line">    return element;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  document.body.appendChild(component());</span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+ if (module.hot) &#123;</span></span><br><span class="line"><span class="addition">+   module.hot.accept('./print.js', function() &#123;</span></span><br><span class="line"><span class="addition">+     console.log('Accepting the updated printMe module!');</span></span><br><span class="line"><span class="addition">+     printMe();</span></span><br><span class="line"><span class="addition">+   &#125;)</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="存在问题（需要重新绑定模块）"><a href="#存在问题（需要重新绑定模块）" class="headerlink" title="存在问题（需要重新绑定模块）"></a>存在问题（需要重新绑定模块）</h3><p>​        如果更新后点击示例页面上的按钮，会发现控制台仍在打印旧的 <code>printMe</code> 功能。这是因为按钮的 <code>onclick</code> 事件仍然绑定在旧的 <code>printMe</code> 函数上，需要使用 <code>module.hot.accept</code> 更新绑定到新的 <code>printMe</code> 函数上。</p>
<p><strong>index.js</strong></p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">  import printMe from './print.js';</span><br><span class="line"></span><br><span class="line">  function component() &#123;</span><br><span class="line">    var btn = document.createElement('button');</span><br><span class="line"></span><br><span class="line">    btn.innerHTML = 'Click me and check the console!';</span><br><span class="line">    btn.onclick = printMe;  // onclick 事件绑定原始的 printMe 函数上</span><br><span class="line"></span><br><span class="line">    element.appendChild(btn);</span><br><span class="line"></span><br><span class="line">    return element;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="deletion">- document.body.appendChild(component());</span></span><br><span class="line"><span class="addition">+ let element = component(); // 当 print.js 改变导致页面重新渲染时，重新获取渲染的元素</span></span><br><span class="line"><span class="addition">+ document.body.appendChild(element);</span></span><br><span class="line"></span><br><span class="line">  if (module.hot) &#123;</span><br><span class="line">    module.hot.accept('./print.js', function() &#123;</span><br><span class="line">      console.log('Accepting the updated printMe module!');</span><br><span class="line"><span class="deletion">-     printMe();</span></span><br><span class="line"><span class="addition">+     document.body.removeChild(element);</span></span><br><span class="line"><span class="addition">+     element = component(); // 重新渲染页面后，component 更新 click 事件处理</span></span><br><span class="line"><span class="addition">+     document.body.appendChild(element);</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h2 id="HMR-修改样式表"><a href="#HMR-修改样式表" class="headerlink" title="HMR 修改样式表"></a>HMR 修改样式表</h2><p>​        当更新 CSS 依赖模块时， <code>style-loader</code> 自动在后台使用 <code>module.hot.accept</code> 来修补(patch) <code>&lt;style&gt;</code> 标签，正常添加style-loader、css-loader插件即可。</p>
<h1 id="tree-shaking"><a href="#tree-shaking" class="headerlink" title="tree shaking"></a>tree shaking</h1><h3 id="用于移除-JavaScript-上下文中的未引用代码-dead-code"><a href="#用于移除-JavaScript-上下文中的未引用代码-dead-code" class="headerlink" title="用于移除 JavaScript 上下文中的未引用代码(dead-code)"></a>用于移除 JavaScript 上下文中的未引用代码(dead-code)</h3><h2 id="将文件标记为无副作用-side-effect-free"><a href="#将文件标记为无副作用-side-effect-free" class="headerlink" title="将文件标记为无副作用(side-effect-free)"></a>将文件标记为无副作用(side-effect-free)</h2><p>​        <a href="https://babeljs.io/learn-es2015/" target="_blank" rel="noopener">ES2015</a> 中的 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import" target="_blank" rel="noopener"><code>import</code></a> 和 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export" target="_blank" rel="noopener"><code>export</code></a> 语句已经被标准化，webpack 不会更改代码中除 <code>import</code> 和 <code>export</code> 语句以外的部分。</p>
<p>​        在一个纯粹的 ESM 模块世界中，识别出哪些文件有副作用很简单。然而，通常项目无法达到这种纯度。此时有必要向 webpack 的 compiler 提供提示，表明项目中的哪些文件是 “pure(纯的 ES2015 模块)”，由此可以安全地删除文件中未使用的部分。</p>
<h3 id="所有代码都不包含副作用"><a href="#所有代码都不包含副作用" class="headerlink" title="所有代码都不包含副作用"></a>所有代码都不包含副作用</h3><h4 id="package-json-4"><a href="#package-json-4" class="headerlink" title="package.json"></a>package.json</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"your-project"</span>,</span><br><span class="line">  <span class="attr">"sideEffects"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="副作用黑名单（不进行tree-shaking操作）"><a href="#副作用黑名单（不进行tree-shaking操作）" class="headerlink" title="副作用黑名单（不进行tree shaking操作）"></a>副作用黑名单（不进行tree shaking操作）</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"your-project"</span>,</span><br><span class="line">  <span class="attr">"sideEffects"</span>: [</span><br><span class="line">    <span class="string">"./src/some-side-effectful-file.js"</span>,</span><br><span class="line">    <span class="string">"*.css"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>常见副作用模块：全局样式表、全局配置的 js 文件</p>
<p>全局 CSS 是直接导入到 JavaScript 文件中的样式表，它没有被转换成 CSS 模块或任何类似的东西</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./MyStylesheet.css'</span>;</span><br></pre></td></tr></table></figure>

<p>以上述方式导入的任何样式表，被 webpack 视为死代码，从输出中删除，需要设置黑名单。</p>
<h2 id="压缩输出"><a href="#压缩输出" class="headerlink" title="压缩输出"></a>压缩输出</h2><h3 id="生产模式"><a href="#生产模式" class="headerlink" title="生产模式"></a>生产模式</h3><h4 id="代码压缩（去除空格、缩短变量名）-tree-shaking（移除未引用代码）"><a href="#代码压缩（去除空格、缩短变量名）-tree-shaking（移除未引用代码）" class="headerlink" title="代码压缩（去除空格、缩短变量名）+ tree shaking（移除未引用代码）"></a>代码压缩（去除空格、缩短变量名）+ tree shaking（移除未引用代码）</h4><h5 id="webpack-config-js-10"><a href="#webpack-config-js-10" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const path = require('path');</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  entry: './src/index.js',</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: 'bundle.js',</span><br><span class="line">    path: path.resolve(__dirname, 'dist')</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="addition">+ mode: "production"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="开发模式"><a href="#开发模式" class="headerlink" title="开发模式"></a>开发模式</h3><h4 id="未压缩便于调试"><a href="#未压缩便于调试" class="headerlink" title="未压缩便于调试"></a>未压缩便于调试</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mode: "development"</span><br></pre></td></tr></table></figure>







<h1 id="通用、生产、开发环境配置分离"><a href="#通用、生产、开发环境配置分离" class="headerlink" title="通用、生产、开发环境配置分离"></a>通用、生产、开发环境配置分离</h1><p>​        在<em>开发环境</em>中，需要具有实时重新加载(live reloading)或热模块替换(hot module replacement)能力的 source map 和 localhost server。而在<em>生产环境</em>中，目标则转向于关注更小的 bundle，更轻量的 source map，以及更优化的资源，以改善加载时间。使用<code>webpack-merge</code>为每个环境编写<strong>彼此独立的 webpack 配置</strong>，同时遵循不重复原则，保留一个“通用”配置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack-merge</span><br></pre></td></tr></table></figure>



<h4 id="目录结构-1"><a href="#目录结构-1" class="headerlink" title="目录结构"></a>目录结构</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  webpack-demo</span><br><span class="line">  |- package.json</span><br><span class="line"><span class="deletion">- |- webpack.config.js</span></span><br><span class="line"><span class="addition">+ |- webpack.common.js</span></span><br><span class="line"><span class="addition">+ |- webpack.dev.js</span></span><br><span class="line"><span class="addition">+ |- webpack.prod.js</span></span><br><span class="line">  |- /dist</span><br><span class="line">  |- /src</span><br><span class="line">    |- index.js</span><br><span class="line">    |- math.js</span><br><span class="line">  |- /node_modules</span><br></pre></td></tr></table></figure>

<h4 id="webpack-common-js"><a href="#webpack-common-js" class="headerlink" title="webpack.common.js"></a>webpack.common.js</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ const path = require('path');</span></span><br><span class="line"><span class="addition">+ const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin');</span></span><br><span class="line"><span class="addition">+ const HtmlWebpackPlugin = require('html-webpack-plugin');</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+ module.exports = &#123;</span></span><br><span class="line"><span class="addition">+   entry: &#123;</span></span><br><span class="line"><span class="addition">+     app: './src/index.js'</span></span><br><span class="line"><span class="addition">+   &#125;,</span></span><br><span class="line"><span class="addition">+   plugins: [</span></span><br><span class="line"><span class="addition">+     new CleanWebpackPlugin(),</span></span><br><span class="line"><span class="addition">+     new HtmlWebpackPlugin(&#123;</span></span><br><span class="line"><span class="addition">+       title: 'Production'</span></span><br><span class="line"><span class="addition">+     &#125;)</span></span><br><span class="line"><span class="addition">+   ],</span></span><br><span class="line"><span class="addition">+   output: &#123;</span></span><br><span class="line"><span class="addition">+     filename: '[name].bundle.js',</span></span><br><span class="line"><span class="addition">+     path: path.resolve(__dirname, 'dist')</span></span><br><span class="line"><span class="addition">+   &#125;</span></span><br><span class="line"><span class="addition">+ &#125;;</span></span><br></pre></td></tr></table></figure>

<h4 id="webpack-dev-js"><a href="#webpack-dev-js" class="headerlink" title="webpack.dev.js"></a>webpack.dev.js</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ const merge = require('webpack-merge');</span></span><br><span class="line"><span class="addition">+ const common = require('./webpack.common.js');</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+ module.exports = merge(common, &#123;</span></span><br><span class="line"><span class="addition">+   devtool: 'inline-source-map',</span></span><br><span class="line"><span class="addition">+   devServer: &#123;</span></span><br><span class="line"><span class="addition">+     contentBase: './dist'</span></span><br><span class="line"><span class="addition">+   &#125;</span></span><br><span class="line"><span class="addition">+ &#125;);</span></span><br></pre></td></tr></table></figure>

<h4 id="webpack-prod-js"><a href="#webpack-prod-js" class="headerlink" title="webpack.prod.js"></a>webpack.prod.js</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ const merge = require('webpack-merge');</span></span><br><span class="line"><span class="addition">+ const UglifyJSPlugin = require('uglifyjs-webpack-plugin');</span></span><br><span class="line"><span class="addition">+ const common = require('./webpack.common.js');</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+ module.exports = merge(common, &#123;</span></span><br><span class="line"><span class="addition">+   plugins: [</span></span><br><span class="line"><span class="addition">+     new UglifyJSPlugin()</span></span><br><span class="line"><span class="addition">+   ]</span></span><br><span class="line"><span class="addition">+ &#125;);</span></span><br></pre></td></tr></table></figure>

<h3 id="NPM-Scripts"><a href="#NPM-Scripts" class="headerlink" title="NPM Scripts"></a>NPM Scripts</h3><h5 id="package-json-5"><a href="#package-json-5" class="headerlink" title="package.json"></a>package.json</h5><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  &#123;</span><br><span class="line">    "scripts": &#123;</span><br><span class="line"><span class="deletion">-     "start": "webpack-dev-server --open",</span></span><br><span class="line"><span class="addition">+     "start": "webpack-dev-server --open --config webpack.dev.js",</span></span><br><span class="line"><span class="deletion">-     "build": "webpack"</span></span><br><span class="line"><span class="addition">+     "build": "webpack --config webpack.prod.js"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    "devDependencies": &#123;</span><br><span class="line">      "clean-webpack-plugin": "^0.1.17",</span><br><span class="line">      "html-webpack-plugin": "^2.29.0",</span><br><span class="line">      "webpack": "^3.0.0",</span><br><span class="line">      "webpack-dev-server": "^2.9.1",</span><br><span class="line">      "webpack-merge": "^4.1.0",</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h2 id="NODE-ENV系统环境变量"><a href="#NODE-ENV系统环境变量" class="headerlink" title="NODE_ENV系统环境变量"></a>NODE_ENV系统环境变量</h2><p><code>NODE_ENV</code> <em>是一个由 Node.js 暴露给执行脚本的系统环境变量。通常用于决定在开发环境与生产环境(dev-vs-prod)下，服务器工具、构建脚本和客户端 library 的行为。</em></p>
<p><strong>webpack.prod.js</strong></p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ const webpack = require('webpack');</span></span><br><span class="line">  const merge = require('webpack-merge');</span><br><span class="line">  const UglifyJSPlugin = require('uglifyjs-webpack-plugin');</span><br><span class="line">  const common = require('./webpack.common.js');</span><br><span class="line"></span><br><span class="line">  module.exports = merge(common, &#123;</span><br><span class="line">    devtool: 'source-map',</span><br><span class="line">    plugins: [</span><br><span class="line">      new UglifyJSPlugin(&#123;</span><br><span class="line">        sourceMap: true</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="addition">+     new webpack.DefinePlugin(&#123;</span></span><br><span class="line"><span class="addition">+       'process.env.NODE_ENV': JSON.stringify('production')</span></span><br><span class="line"><span class="addition">+     &#125;)</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="任何位于-src-的本地代码都可以关联到-process-env-NODE-ENV-环境变量"><a href="#任何位于-src-的本地代码都可以关联到-process-env-NODE-ENV-环境变量" class="headerlink" title="任何位于 /src 的本地代码都可以关联到 process.env.NODE_ENV 环境变量"></a>任何位于 <code>/src</code> 的本地代码都可以关联到 process.env.NODE_ENV 环境变量</h4><h5 id="src-index-js"><a href="#src-index-js" class="headerlink" title="src/index.js"></a>src/index.js</h5><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ if (process.env.NODE_ENV !== 'production') &#123;</span></span><br><span class="line"><span class="addition">+   console.log('Looks like we are in development mode!');</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br></pre></td></tr></table></figure>







<h1 id="代码分离"><a href="#代码分离" class="headerlink" title="代码分离"></a>代码分离</h1><p>​        把代码分离到不同的 bundle 中，然后可以按需加载或并行加载这些文件。代码分离可以用于获取更小的 bundle，按需加载或并行加载，控制资源加载优先级，如果使用合理，会极大影响加载时间。</p>
<h4 id="三种常用的代码分离方法："><a href="#三种常用的代码分离方法：" class="headerlink" title="三种常用的代码分离方法："></a>三种常用的代码分离方法：</h4><ul>
<li>入口起点：使用 <a href="https://www.webpackjs.com/configuration/entry-context" target="_blank" rel="noopener"><code>entry</code></a> 配置手动地分离代码。</li>
<li>防止重复：使用 <a href="https://www.webpackjs.com/plugins/commons-chunk-plugin" target="_blank" rel="noopener"><code>CommonsChunkPlugin</code></a> 去重和分离 chunk。</li>
<li>动态导入：通过模块的内联函数调用来分离代码。</li>
</ul>
<h2 id="入口起点-entry-points"><a href="#入口起点-entry-points" class="headerlink" title="入口起点(entry points)"></a>入口起点(entry points)</h2><h5 id="project"><a href="#project" class="headerlink" title="project"></a>project</h5><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">webpack-demo</span><br><span class="line">|- package.json</span><br><span class="line">|- webpack.config.js</span><br><span class="line">|- /dist</span><br><span class="line">|- /src</span><br><span class="line">  |- index.js</span><br><span class="line"><span class="addition">+ |- another-module.js</span></span><br><span class="line">|- /node_modules</span><br></pre></td></tr></table></figure>

<h5 id="another-module-js"><a href="#another-module-js" class="headerlink" title="another-module.js"></a>another-module.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  _.join([<span class="string">'Another'</span>, <span class="string">'module'</span>, <span class="string">'loaded!'</span>], <span class="string">' '</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="webpack-config-js-11"><a href="#webpack-config-js-11" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> HTMLWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    another: <span class="string">'./src/another-module.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HTMLWebpackPlugin(&#123;</span><br><span class="line">      title: <span class="string">'Code Splitting'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="构建结果："><a href="#构建结果：" class="headerlink" title="构建结果："></a>构建结果：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">            Asset    Size  Chunks                    Chunk Names</span><br><span class="line">  index.bundle.js  544 kB       0  [emitted]  [big]  index</span><br><span class="line">another.bundle.js  544 kB       1  [emitted]  [big]  another</span><br></pre></td></tr></table></figure>

<h5 id="index-js和another-module-js都含有lodash模块"><a href="#index-js和another-module-js都含有lodash模块" class="headerlink" title="index.js和another-module.js都含有lodash模块"></a><code>index.js</code>和<code>another-module.js</code>都含有<code>lodash</code>模块</h5><h4 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h4><ul>
<li>如果入口 chunks 之间包含重复的模块，那些重复模块都会被引入到各个 bundle 中。</li>
<li>这种方法不够灵活，并且不能将核心应用程序逻辑进行动态拆分代码。</li>
</ul>
<h2 id="防止重复-prevent-duplication"><a href="#防止重复-prevent-duplication" class="headerlink" title="防止重复(prevent duplication)"></a>防止重复(prevent duplication)</h2><p>​        <a href="https://www.webpackjs.com/plugins/commons-chunk-plugin" target="_blank" rel="noopener"><code>CommonsChunkPlugin</code></a> 插件可以将公共的依赖模块提取到已有的入口 chunk 中，或者提取到一个新生成的 chunk。</p>
<h4 id="webpack-config-js-12"><a href="#webpack-config-js-12" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  const path = require('path');</span><br><span class="line"><span class="addition">+ const webpack = require('webpack');</span></span><br><span class="line">  const HTMLWebpackPlugin = require('html-webpack-plugin');</span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">      index: './src/index.js',</span><br><span class="line">      another: './src/another-module.js'</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      new HTMLWebpackPlugin(&#123;</span><br><span class="line">        title: 'Code Splitting'</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="addition">+     new webpack.optimize.CommonsChunkPlugin(&#123;</span></span><br><span class="line"><span class="addition">+       name: 'common' // 指定公共 bundle 的名称。</span></span><br><span class="line"><span class="addition">+     &#125;)</span></span><br><span class="line">    ],</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: '[name].bundle.js',</span><br><span class="line">      path: path.resolve(__dirname, 'dist')</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<h4 id="构建效果："><a href="#构建效果：" class="headerlink" title="构建效果："></a>构建效果：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">            Asset       Size  Chunks                    Chunk Names</span><br><span class="line">  index.bundle.js  665 bytes       0  [emitted]         index</span><br><span class="line">another.bundle.js  537 bytes       1  [emitted]         another</span><br><span class="line"> common.bundle.js     547 kB       2  [emitted]  [big]  common</span><br></pre></td></tr></table></figure>



<h2 id="动态导入-dynamic-imports"><a href="#动态导入-dynamic-imports" class="headerlink" title="动态导入(dynamic imports)"></a>动态导入(dynamic imports)</h2><h3 id="在index-js中动态导入-lodash模块"><a href="#在index-js中动态导入-lodash模块" class="headerlink" title="在index.js中动态导入 lodash模块"></a>在<code>index.js</code>中动态导入 <code>lodash</code>模块</h3><h5 id="webpack-config-js-13"><a href="#webpack-config-js-13" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  const path = require('path');</span><br><span class="line">  const HTMLWebpackPlugin = require('html-webpack-plugin');</span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">      index: './src/index.js'</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      new HTMLWebpackPlugin(&#123;</span><br><span class="line">        title: 'Code Splitting'</span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: '[name].bundle.js',</span><br><span class="line"><span class="addition">+     chunkFilename: '[name].bundle.js',	//决定非入口 chunk 的名称</span></span><br><span class="line">      path: path.resolve(__dirname, 'dist')</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<h4 id="src-index-js-1"><a href="#src-index-js-1" class="headerlink" title="src/index.js"></a>src/index.js</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- import _ from 'lodash';</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">- function component() &#123;</span></span><br><span class="line"><span class="addition">+ function getComponent() &#123;</span></span><br><span class="line"><span class="deletion">-   var element = document.createElement('div');</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-   // Lodash, now imported by this script</span></span><br><span class="line"><span class="deletion">-   element.innerHTML = _.join(['Hello', 'webpack'], ' ');</span></span><br><span class="line"><span class="addition">+   return import(/* webpackChunkName: "lodash" */ 'lodash').then(_ =&gt; &#123;</span></span><br><span class="line"><span class="addition">+     var element = document.createElement('div');</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+     element.innerHTML = _.join(['Hello', 'webpack'], ' ');</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+     return element;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+   &#125;).catch(error =&gt; 'An error occurred while loading the component');</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="deletion">- document.body.appendChild(component());</span></span><br><span class="line"><span class="addition">+ getComponent().then(component =&gt; &#123;</span></span><br><span class="line"><span class="addition">+   document.body.appendChild(component);</span></span><br><span class="line"><span class="addition">+ &#125;)</span></span><br></pre></td></tr></table></figure>

<h4 id="lodash-自动会分离到一个单独的-bundle："><a href="#lodash-自动会分离到一个单独的-bundle：" class="headerlink" title="lodash 自动会分离到一个单独的 bundle："></a><code>lodash</code> 自动会分离到一个单独的 bundle：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">           Asset     Size  Chunks                    Chunk Names</span><br><span class="line">lodash.bundle.js   541 kB       0  [emitted]  [big]  lodash</span><br><span class="line"> index.bundle.js  6.35 kB       1  [emitted]         index</span><br></pre></td></tr></table></figure>



<h3 id="async-函数简化代码："><a href="#async-函数简化代码：" class="headerlink" title="async 函数简化代码："></a><code>async</code> 函数简化代码：</h3><p>​        <code>import()</code> 会返回一个 promise，可以和 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank" rel="noopener"><code>async</code> 函数</a>一起使用。但是，需要使用像 Babel 的预处理器和<a href="https://babeljs.io/docs/plugins/syntax-dynamic-import/#installation" target="_blank" rel="noopener">Syntax Dynamic Import Babel Plugin</a>。</p>
<h4 id="src-index-js-2"><a href="#src-index-js-2" class="headerlink" title="src/index.js"></a>src/index.js</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- function getComponent() &#123;</span></span><br><span class="line"><span class="addition">+ async function getComponent() &#123;</span></span><br><span class="line"><span class="deletion">-   return import(/* webpackChunkName: "lodash" */ 'lodash').then(_ =&gt; &#123;</span></span><br><span class="line"><span class="deletion">-     var element = document.createElement('div');</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-     element.innerHTML = _.join(['Hello', 'webpack'], ' ');</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-     return element;</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-   &#125;).catch(error =&gt; 'An error occurred while loading the component');</span></span><br><span class="line"><span class="addition">+   var element = document.createElement('div');</span></span><br><span class="line"><span class="addition">+   const _ = await import(/* webpackChunkName: "lodash" */ 'lodash');</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+   element.innerHTML = _.join(['Hello', 'webpack'], ' ');</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+   return element;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getComponent().then(component =&gt; &#123;</span><br><span class="line">    document.body.appendChild(component);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>







<h1 id="懒加载"><a href="#懒加载" class="headerlink" title="懒加载"></a>懒加载</h1><p>​        上文代码分离部分，lodash`包每次加载页面都需要请求它，没有分离的必要，会对性能产生负面影响。下面举一个实用例子。</p>
<p>​        增加一个交互，当用户点击按钮的时候用 console 打印一些文字。但是会等到第一次交互的时候再加载那个代码块（<code>print.js</code>）</p>
<h4 id="src-print-js"><a href="#src-print-js" class="headerlink" title="src/print.js"></a>src/print.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'The print.js module has loaded! See the network tab in dev tools...'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Button Clicked: Here\'s "some text"!'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="src-index-js-3"><a href="#src-index-js-3" class="headerlink" title="src/index.js"></a>src/index.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">component</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> element = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  <span class="keyword">var</span> button = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>);</span><br><span class="line">  <span class="keyword">var</span> br = <span class="built_in">document</span>.createElement(<span class="string">'br'</span>);</span><br><span class="line"></span><br><span class="line">  button.innerHTML = <span class="string">'Click me and look at the console!'</span>;</span><br><span class="line">  element.innerHTML = _.join([<span class="string">'Hello'</span>, <span class="string">'webpack'</span>], <span class="string">' '</span>);</span><br><span class="line">  element.appendChild(br);</span><br><span class="line">  element.appendChild(button);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// Note that because a network request is involved, some indication</span></span><br><span class="line">  <span class="comment">// of loading would need to be shown in a production-level site/app.</span></span><br><span class="line">  button.onclick = <span class="function"><span class="params">e</span> =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: "print" */</span> <span class="string">'./print'</span>).then(<span class="function"><span class="params">module</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> print = <span class="built_in">module</span>.default;</span><br><span class="line">    print();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> element;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(component());</span><br></pre></td></tr></table></figure>







<h1 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h1><p>​        如果我们在部署新版本时不更改资源的文件名，浏览器可能会认为它没有被更新，就会使用它的缓存版本。通过配置确保 webpack 编译生成的文件能够被客户端缓存，而在文件内容变化后，能够请求到新的文件。</p>
<h2 id="chunkhash替换输出文件名"><a href="#chunkhash替换输出文件名" class="headerlink" title="chunkhash替换输出文件名"></a><code>chunkhash</code>替换输出文件名</h2><p><code>[hash]</code> 替换，在文件名中包含一个构建相关(build-specific)的 hash，</p>
<p><code>[chunkhash]</code> 替换，在文件名中包含一个 chunk 相关(chunk-specific)的哈希。</p>
<h4 id="webpack-config-js-14"><a href="#webpack-config-js-14" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin([<span class="string">'dist'</span>]),</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      title: <span class="string">'Caching'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'[name].[chunkhash].js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="构建结果：-1"><a href="#构建结果：-1" class="headerlink" title="构建结果："></a>构建结果：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">                       Asset       Size  Chunks                    Chunk Names</span><br><span class="line">main.7e2c49a622975ebd9b7e.js     544 kB       0  [emitted]  [big]  main</span><br><span class="line">                  index.html  197 bytes          [emitted]</span><br></pre></td></tr></table></figure>

<p>如果不做修改，再次运行构建，会发现文件名<strong>还是改变了</strong>（可能会变）</p>
<h5 id="这是因为-webpack-在入口-chunk-中，包含了某些样板-boilerplate-，特别是-runtime和-manifest。（样板-boilerplate-指-webpack-运行时的引导代码）"><a href="#这是因为-webpack-在入口-chunk-中，包含了某些样板-boilerplate-，特别是-runtime和-manifest。（样板-boilerplate-指-webpack-运行时的引导代码）" class="headerlink" title="这是因为 webpack 在入口 chunk 中，包含了某些样板(boilerplate)，特别是 runtime和 manifest。（样板(boilerplate)指 webpack 运行时的引导代码）"></a>这是因为 webpack 在入口 chunk 中，包含了某些样板(boilerplate)，特别是 <code>runtime</code>和 <code>manifest</code>。（样板(boilerplate)指 webpack 运行时的引导代码）</h5><h2 id="提取模板-Extracting-Boilerplate"><a href="#提取模板-Extracting-Boilerplate" class="headerlink" title="提取模板(Extracting Boilerplate)"></a>提取模板(Extracting Boilerplate)</h2><h4 id="CommonsChunkPlugin-可将webpack-的样板和-manifest-提取出来"><a href="#CommonsChunkPlugin-可将webpack-的样板和-manifest-提取出来" class="headerlink" title="CommonsChunkPlugin 可将webpack 的样板和 manifest 提取出来"></a><code>CommonsChunkPlugin</code> 可将webpack 的样板和 manifest 提取出来</h4><h5 id="webpack-config-js-15"><a href="#webpack-config-js-15" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h5><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  const path = require('path');</span><br><span class="line"><span class="addition">+ const webpack = require('webpack');</span></span><br><span class="line">  const CleanWebpackPlugin = require('clean-webpack-plugin');</span><br><span class="line">  const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    entry: './src/index.js',</span><br><span class="line">    plugins: [</span><br><span class="line">      new CleanWebpackPlugin(['dist']),</span><br><span class="line">      new HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: 'Caching'</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="addition">+     new webpack.optimize.CommonsChunkPlugin(&#123;</span></span><br><span class="line"><span class="addition">+       name: 'manifest'	//通过指定 entry 配置中未用到的名称</span></span><br><span class="line"><span class="addition">+     &#125;)</span></span><br><span class="line">    ],</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: '[name].[chunkhash].js',</span><br><span class="line">      path: path.resolve(__dirname, 'dist')</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="提取第三方库"><a href="#提取第三方库" class="headerlink" title="提取第三方库"></a>提取第三方库</h3><p>​        通过使用新的 <code>entry(入口)</code> 起点，以及再额外配置一个 <code>CommonsChunkPlugin</code> 实例的组合方式，将更新频率低的第三方库(library)提取到单独的 <code>vendor</code> chunk 文件中。</p>
<h4 id="webpack-config-js-16"><a href="#webpack-config-js-16" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">  var path = require('path');</span><br><span class="line">  const webpack = require('webpack');</span><br><span class="line">  const CleanWebpackPlugin = require('clean-webpack-plugin');</span><br><span class="line">  const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line"><span class="deletion">-   entry: './src/index.js',</span></span><br><span class="line"><span class="addition">+   entry: &#123;</span></span><br><span class="line"><span class="addition">+     main: './src/index.js',</span></span><br><span class="line"><span class="addition">+     vendor: [</span></span><br><span class="line"><span class="addition">+       'lodash'</span></span><br><span class="line"><span class="addition">+     ]</span></span><br><span class="line"><span class="addition">+   &#125;,</span></span><br><span class="line">    plugins: [</span><br><span class="line">      new CleanWebpackPlugin(['dist']),</span><br><span class="line">      new HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: 'Caching'</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="addition">+     new webpack.optimize.CommonsChunkPlugin(&#123;</span></span><br><span class="line"><span class="addition">+       name: 'vendor'</span></span><br><span class="line"><span class="addition">+     &#125;),</span></span><br><span class="line">      new webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">        name: 'manifest'</span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: '[name].[chunkhash].js',</span><br><span class="line">      path: path.resolve(__dirname, 'dist')</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<h4 id="构建结果：-2"><a href="#构建结果：-2" class="headerlink" title="构建结果："></a>构建结果：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">                           Asset       Size  Chunks                    Chunk Names</span><br><span class="line">  vendor.8196d409d2f988123318.js     541 kB       0  [emitted]  [big]  vendor</span><br><span class="line">    main.0ac0ae2d4a11214ccd19.js  791 bytes       1  [emitted]         main</span><br><span class="line">manifest.004a1114de8bcf026622.js    5.85 kB       2  [emitted]         manifest</span><br><span class="line">                      index.html  352 bytes          [emitted]</span><br></pre></td></tr></table></figure>



<h2 id="模块标识符-Module-Identifiers"><a href="#模块标识符-Module-Identifiers" class="headerlink" title="模块标识符(Module Identifiers)"></a>模块标识符(Module Identifiers)</h2><p>​        添加一个模块 <code>print.js</code>，再次运行构建，期望只有 <code>main</code> bundle 的 hash 发生变化。</p>
<p>​        然而，三个文件的 hash <strong>都变化了</strong>。这是因为每个 <a href="https://www.webpackjs.com/api/module-variables#module-id-commonjs-" target="_blank" rel="noopener"><code>module.id</code></a> 会基于默认的解析顺序(resolve order)进行增量。也就是说，当解析顺序发生变化，ID 也会随之改变。因此，简要概括：</p>
<ul>
<li><code>main</code> bundle 会随着自身的新增内容的修改，而发生变化。</li>
<li><code>vendor</code> bundle 会随着自身的 <code>module.id</code> 的修改，而发生变化。</li>
<li><code>manifest</code> bundle 会因为当前包含一个新模块的引用，而发生变化。</li>
</ul>
<p>​        第一个和最后一个都是符合预期的行为，而 <code>vendor</code> 的 hash 发生变化是需要修复的。使用两个插件来解决这个问题。</p>
<p> <a href="https://www.webpackjs.com/plugins/named-modules-plugin" target="_blank" rel="noopener"><code>NamedModulesPlugin</code></a>，将使用模块的路径，而不是数字标识符。虽然此插件有助于在开发过程中输出结果的可读性，然而执行时间会长一些。</p>
<h4 id="HashedModuleIdsPlugin，推荐用于生产环境构建："><a href="#HashedModuleIdsPlugin，推荐用于生产环境构建：" class="headerlink" title="HashedModuleIdsPlugin，推荐用于生产环境构建："></a><a href="https://www.webpackjs.com/plugins/hashed-module-ids-plugin" target="_blank" rel="noopener"><code>HashedModuleIdsPlugin</code></a>，推荐用于生产环境构建：</h4><h4 id="webpack-config-js-17"><a href="#webpack-config-js-17" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">	<span class="keyword">new</span> webpack.HashedModuleIdsPlugin()</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>现在不管再添加任何新的本地依赖，每次构建<code>vendor</code> hash 都保持一致。</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Zimomo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="/zimomo333.com/2020/08/12/webpack/">zimomo333.com/2020/08/12/webpack/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="zimomo333.com" target="_blank">Zimomo</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/webpack/">webpack</a></div><div class="post_share"><div class="social-share" data-image="/img/debounce.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/08/13/js-debounce-throttle/"><img class="prev_cover lazyload" data-src="/img/debounce.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">js防抖节流</div></div></a></div><div class="next-post pull_right"><a href="/2020/08/10/js-sort/"><img class="next_cover lazyload" data-src="/img/sort.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">js排序算法</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify: false,
  verify: false,
  appId: 'kop9lSK5GHTHe8Y0hIrjrYuB-gzGzoHsz',
  appKey: 'm3C39E4yVzUkTQHHXPYzH7S9',
  placeholder: 'Please leave your footprints',
  avatar: 'monsterid',
  meta: guest_info,
  pageSize: '10',
  lang: 'en',
  recordIP: false,
  serverURLs: ''
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Zimomo</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="icp"><a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>粤ICP备20030762号</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/search/local-search.js"></script></body></html>